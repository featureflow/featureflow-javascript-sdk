<!doctype>
<html>
  <head>
    <meta charset="utf-8">
    <script src="./dist/featureflow.js"></script>
  </head>
  <body>
    <h1>Featureflow test harness</h1>
    <ul id="features">...</ul>
    <script>
      var context = {
        key: 'user1',
          values: {
              tier: 'gold',
              country: 'australia'
          }
      };
      var featureflow = Featureflow.init('fftestjs', context, {
        baseUrl:    'http://localhost:8081',
      });*/
      //var featureflow = Featureflow.init('env-7ee02f8bbf2f4b8eadb135f22650274f', context, {}); //featueflow.io Featureflow Application Local Environment Key

      var config = {baseUrl:    'http://localhost:8081'};
      var apiKey = 'env-ece048bd8b1f408a9a0601b2dc26e78e'; //// featureflow.dev local env

     // var config = {}; //for prod
     // var apiKey = 'env-7ee02f8bbf2f4b8eadb135f22650274f'; //featureflow.io local env


      var featureflow = Featureflow.init(apiKey, context, config); //featureflow prod local env

      function render(key, failoverValue){
        var value = featureflow.evaluate(key, failoverValue);
        var el = document.querySelector('#features');
        el.innerHTML = el.innerHTML + "<li>" + key  + ' = ' + value.toString() + " </li>";
      }
      featureflow.on('update:context', function(context) {
          console.log('Updated!', context);
      });

      featureflow.on('update:controls', function(context) {
        console.log('Updated!', context);
        for (var property in featureflow.controls) {
            if (featureflow.controls.hasOwnProperty(property)) {
                render(property, 'OFF');
            }
        }
        //featureflow.updateContext(context);
      });

      featureflow.on('ready', function() {
        console.log('Ready!');
          for (var property in featureflow.controls) {
              if (featureflow.controls.hasOwnProperty(property)) {
                  render(property, 'OFF');
              }
          }
      });

      function fakeLogin(){
          context = {
              key: "oliver",
              tier: "gold"
          };
          featureflow.updateContext(context);
      }

    </script>
  </body>
</html>
